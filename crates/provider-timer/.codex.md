# provider-timer Codex

You are the **provider-timer** Codex in the `greentic-events-providers` workspace.

## Purpose

Provide a **timer/cron-based event source**:

- `events-timer-source@1.0.0` – `source` world:
  - Emits events on configured schedules (cron/interval).

Host/deployer will integrate with platform-specific timer mechanisms; the component just translates “tick” into an `EventEnvelope`.

## Dependencies

- `provider-core` (for `SchedulerConfig` and helpers).
- `greentic-types`
- `greentic-interfaces-guest` (events `source` world)
- `serde`, `serde_json`, `chrono`

## Tasks

### 1. Topic conventions

- `timer.<name>`
  e.g.:
  - `timer.daily.summary`
  - `timer.hourly.sync`

### 2. `events-timer-source@1.0.0` (source)

Component behaviour:

- Receives a `SchedulerConfig` at initialisation.
- The **host/deployer** is responsible for:
  - mapping cron/interval expressions to actual timed calls into the component.
  - calling a function like `fire(schedule_name, tenant_ctx)` when a schedule triggers.

Define an exported function via WIT bindings that:

- Accepts:
  - `tenant_ctx`
  - `schedule_name`
- Looks up the `Schedule` from `SchedulerConfig`.
- Emits an `EventEnvelope`:
  - `topic = schedule.topic` (e.g. `timer.daily.summary`)
  - `type_ = "com.greentic.timer.generic.v1"`
  - `source = "timer-provider"`
  - `payload = schedule.payload` (preconfigured JSON)
  - `metadata` includes `schedule_name`, `cron`, etc.

### 3. Packs

`packs/events/timer.yaml`:

```yaml
events:
  providers:
    - name: "timer-core"
      kind: "source"
      component: "events-timer-source@1.0.0"
      capabilities:
        transport: "timer"
        reliability: "at_least_once"
        ordering: "none"
        topics:
          - "timer.*"
```

Schedules themselves might be configured in a higher-level config or via flows; for v1 you can document that the host/deployer passes SchedulerConfig into the component.

### 4. Flows
Add flows/events/timer/default.ygtc to demonstrate:
- Timer event → greentic-events → any downstream flow.

### 5. Tests
Unit tests:
- Given a sample SchedulerConfig and a schedule_name, verify the EventEnvelope produced by the fire-like function.
- Pack consistency.

## Constraints
- No actual time scheduling in WASM; host handles timing.
- No domain semantics; just generic “timer fired” events with payload.
